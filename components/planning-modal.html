<head>
</head>
<body>


<div id="planning-modal" class="modal-overlay hidden">
    <div class="modal-content">
        <div class="modal-header">
            <h2>📅 Configurazione Pianificazione Settimanale</h2>
            <button class="modal-close" onclick="closePlanningModal()">×</button>
        </div>
        
        <div class="modal-body">
<!-- Sostituisci la sezione di configurazione generale con questa versione aggiornata -->

<div class="config-section">
    <h3>⚙️ Configurazione Generale</h3>
    
    <!-- Info configurazione giornaliera -->
    <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #2196f3;">
        <p style="margin: 0; font-size: 0.9em; color: #1565c0;">
            💡 <strong>Configurazione Giornaliera:</strong> Puoi personalizzare pasti, calorie e macro per ogni giorno della settimana.
        </p>
    </div>
    
    <!-- Selettore del giorno corrente -->
    <div class="form-group" style="margin-bottom: 20px;">
        <label for="config-day-selector" style="font-weight: bold; color: #667eea;">
            📅 Configura per il giorno:
        </label>
        <select id="config-day-selector" class="form-control" onchange="loadDayConfig(this.value)" style="font-size: 1.1em; padding: 10px;">
            <option value="lunedi">Lunedì</option>
            <option value="martedi">Martedì</option>
            <option value="mercoledi">Mercoledì</option>
            <option value="giovedi">Giovedì</option>
            <option value="venerdi">Venerdì</option>
            <option value="sabato">Sabato</option>
            <option value="domenica">Domenica</option>
        </select>
    </div>

    <div class="config-grid">
        <div class="form-group">
            <label for="daily-kcal">Calorie Target per <span id="config-day-name">Lunedì</span></label>
            <input type="number" id="daily-kcal" class="form-control" 
                   value="2000" min="1000" max="5000" step="50"
                   onchange="updateDayConfig()">
        </div>
        
        <!-- Azioni rapide -->
        <div class="form-group">
            <label>Azioni Rapide</label>
            <button class="btn btn-secondary" onclick="copyConfigToAllDays()" style="width: 100%;">
                📋 Copia configurazione a tutti i giorni
            </button>
        </div>
    </div>

    <!-- Preview Pasti Sempre Visibili -->
    <div id="meals-preview" style="margin-top: 20px;">
        <h4>🍽️ Seleziona Pasti per <span id="meals-day-name">Lunedì</span></h4>
        <div id="meals-selector" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; margin-top: 15px;">
            <!-- Checkbox per ogni pasto -->
            <label class="meal-checkbox-container">
                <input type="checkbox" id="meal-colazione" value="Colazione" checked onchange="updateSelectedMeals()">
                <div class="meal-checkbox-label">
                    <div class="meal-number">1</div>
                    <div class="meal-name">Colazione</div>
                </div>
            </label>
            
            <label class="meal-checkbox-container">
                <input type="checkbox" id="meal-spuntino-mattina" value="Spuntino Mattina" onchange="updateSelectedMeals()">
                <div class="meal-checkbox-label">
                    <div class="meal-number">2</div>
                    <div class="meal-name">Spuntino Mattina</div>
                </div>
            </label>
            
            <label class="meal-checkbox-container">
                <input type="checkbox" id="meal-pranzo" value="Pranzo" checked onchange="updateSelectedMeals()">
                <div class="meal-checkbox-label">
                    <div class="meal-number">3</div>
                    <div class="meal-name">Pranzo</div>
                </div>
            </label>
            
            <label class="meal-checkbox-container">
                <input type="checkbox" id="meal-merenda" value="Merenda" onchange="updateSelectedMeals()">
                <div class="meal-checkbox-label">
                    <div class="meal-number">4</div>
                    <div class="meal-name">Merenda</div>
                </div>
            </label>
            
            <label class="meal-checkbox-container">
                <input type="checkbox" id="meal-cena" value="Cena" checked onchange="updateSelectedMeals()">
                <div class="meal-checkbox-label">
                    <div class="meal-number">5</div>
                    <div class="meal-name">Cena</div>
                </div>
            </label>
            
            <label class="meal-checkbox-container">
                <input type="checkbox" id="meal-spuntino-serale" value="Spuntino Serale" onchange="updateSelectedMeals()">
                <div class="meal-checkbox-label">
                    <div class="meal-number">6</div>
                    <div class="meal-name">Spuntino Serale</div>
                </div>
            </label>
        </div>
        
        <!-- Riepilogo pasti selezionati -->
        <div style="margin-top: 15px; padding: 10px; background: #f8f9fa; border-radius: 8px;">
            <strong>Pasti selezionati:</strong> <span id="selected-meals-count">3</span> pasti
        </div>
    </div>
</div>

            
    <h3>🔬 Limiti Micronutrienti Giornalieri</h3>
    
    <div class="micronutrients-grid">
        <div class="micro-group">
            <label for="limit-sodio">
                <span class="micro-icon">🧂</span> Sodio (mg)
            </label>
            <input type="number" id="limit-sodio" class="form-control micro-input" 
                   placeholder="2300" min="0" step="100">
        </div>
        
        <div class="micro-group">
            <label for="limit-potassio">
                <span class="micro-icon">🍌</span> Potassio (mg)
            </label>
            <input type="number" id="limit-potassio" class="form-control micro-input" 
                   placeholder="3500" min="0" step="100">
        </div>
        
        <div class="micro-group">
            <label for="limit-calcio">
                <span class="micro-icon">🦴</span> Calcio (mg)
            </label>
            <input type="number" id="limit-calcio" class="form-control micro-input" 
                   placeholder="1000" min="0" step="50">
        </div>
        
        <div class="micro-group">
            <label for="limit-ferro">
                <span class="micro-icon">⚡</span> Ferro (mg)
            </label>
            <input type="number" id="limit-ferro" class="form-control micro-input" 
                   placeholder="18" min="0" step="1">
        </div>
        
        <div class="micro-group">
            <label for="limit-vitamina-d">
                <span class="micro-icon">☀️</span> Vitamina D (μg)
            </label>
            <input type="number" id="limit-vitamina-d" class="form-control micro-input" 
                   placeholder="15" min="0" step="1">
        </div>
        
        <div class="micro-group">
            <label for="limit-vitamina-a">
                <span class="micro-icon">🥕</span> Vitamina A (μg)
            </label>
            <input type="number" id="limit-vitamina-a" class="form-control micro-input" 
                   placeholder="900" min="0" step="50">
        </div>
        
        <div class="micro-group">
            <label for="limit-vitamina-c">
                <span class="micro-icon">🍊</span> Vitamina C (mg)
            </label>
            <input type="number" id="limit-vitamina-c" class="form-control micro-input" 
                   placeholder="90" min="0" step="10">
        </div>
        
        <div class="micro-group">
            <label for="limit-vitamina-b1">
                <span class="micro-icon">🌾</span> Vitamina B1 (mg)
            </label>
            <input type="number" id="limit-vitamina-b1" class="form-control micro-input" 
                   placeholder="1.2" min="0" step="0.1">
        </div>
        
        <div class="micro-group">
            <label for="limit-vitamina-b12">
                <span class="micro-icon">🧬</span> Vitamina B12 (μg)
            </label>
            <input type="number" id="limit-vitamina-b12" class="form-control micro-input" 
                   placeholder="2.4" min="0" step="0.1">
        </div>
        
        <div class="micro-group">
            <label for="limit-folati">
                <span class="micro-icon">🍃</span> Folati (μg)
            </label>
            <input type="number" id="limit-folati" class="form-control micro-input" 
                   placeholder="400" min="0" step="50">
        </div>
    </div>
    
    <div class="micro-info">
        <p>💡 <strong>Suggerimento:</strong> I valori inseriti rappresentano i limiti massimi giornalieri. 
        Se un micronutriente supera il limite, verrà evidenziato in rosso nel totale giornaliero.</p>
    </div>
</div>

            <div class="config-section">
                <h3>🥗 Ripartizione Macronutrienti</h3>
                
                <div class="macro-sliders">
                    <div class="slider-group">
                                <label for="protein-slider">Proteine</label>
                                <input type="range" id="protein-slider" class="macro-slider"
                                    min="0" max="100" value="30" oninput="updateMacroChart()">
                                <span class="slider-value"><span id="protein-value">30</span>%</span>
                            </div>
                            <div class="slider-group">
                                <label for="carbs-slider">Carboidrati</label>
                                <input type="range" id="carbs-slider" class="macro-slider"
                                    min="0" max="100" value="40" oninput="updateMacroChart()">
                                <span class="slider-value"><span id="carbs-value">40</span>%</span>
                            </div>
                            <div class="slider-group">
                                <label for="fats-slider">Grassi</label>
                                <input type="range" id="fats-slider" class="macro-slider"
                                    min="0" max="100" value="30" oninput="updateMacroChart()">
                                <span class="slider-value"><span id="fats-value">30</span>%</span>
                            </div>
                            <div id="macro-warning" class="warning-message" style="display: none;">
                                ⚠️ La somma dei macronutrienti supera il 100%!
                        </div>
                </div>


                <!-- Info Calorie per Macro -->
                <div style="background: white; padding: 15px; border-radius: 10px; margin-top: 20px;">
                    <h4>📊 Distribuzione Calorie</h4>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; text-align: center; margin-top: 10px;">
                        <div>
                            <div style="font-weight: bold; color: #ff6b6b;" id="protein-kcal">240</div>
                            <div style="font-size: 0.9em; color: #666;">kcal da proteine</div>
                            <div style="font-size: 0.8em; color: #999;" id="protein-grams">60g</div>
                        </div>
                        <div>
                            <div style="font-weight: bold; color: #b6cd4e;" id="carbs-kcal">320</div>
                            <div style="font-size: 0.9em; color: #666;">kcal da carboidrati</div>
                            <div style="font-size: 0.8em; color: #999;" id="carbs-grams">80g</div>
                        </div>
                        <div>
                            <div style="font-weight: bold; color: #45b7d1;" id="fats-kcal">270</div>
                            <div style="font-size: 0.9em; color: #666;">kcal da grassi</div>
                            <div style="font-size: 0.8em; color: #999;" id="fats-grams">30g</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Azioni -->
            <div style="text-align: center; margin-top: 30px;">
                <button class="btn btn-primary btn-large" onclick="proceedToPlanning()">
                    ➡️ Continua con Pianificazione
                </button>
                <button class="btn btn-secondary" onclick="closePlanningModal()">
                    ❌ Annulla
                </button>
            </div>

            <!-- SEZIONE PIANIFICAZIONE SETTIMANALE -->
            <div id="planning-section" class="planning-section">
                <h3>📅 Pianificazione Settimanale</h3>
                
                <!-- Tab Giorni -->
                <div class="week-tabs">
                    <button class="day-tab active" data-day="lunedi" onclick="showDayPlanning('lunedi')">LUN</button>
                    <button class="day-tab" data-day="martedi" onclick="showDayPlanning('martedi')">MAR</button>
                    <button class="day-tab" data-day="mercoledi" onclick="showDayPlanning('mercoledi')">MER</button>
                    <button class="day-tab" data-day="giovedi" onclick="showDayPlanning('giovedi')">GIO</button>
                    <button class="day-tab" data-day="venerdi" onclick="showDayPlanning('venerdi')">VEN</button>
                    <button class="day-tab" data-day="sabato" onclick="showDayPlanning('sabato')">SAB</button>
                    <button class="day-tab" data-day="domenica" onclick="showDayPlanning('domenica')">DOM</button>
                </div>

                <!-- Pianificazione del Giorno -->
                <div class="day-planning">
                    <h4 id="current-day-title">📅 Lunedì</h4>
                    <div id="meals-planning">
                        <!-- Generato dinamicamente -->
                    </div>
                </div>

                <!-- Pulsanti Finali -->
                    <!-- Pulsanti Finali AGGIORNATI -->
                    <div style="text-align: center; margin-top: 30px;">
                        <button class="btn btn-secondary" onclick="closePlanningModal()">
                            ⬅️ Torna a Configurazione
                        </button>
                        <button class="btn btn-primary btn-large" onclick="savePianificazioneSettimanale()" id="save-planning-btn">
                            💾 Salva Piano Settimanale
                        </button>
                    </div>
            </div>
        </div>
    </div>
</div>
</body>